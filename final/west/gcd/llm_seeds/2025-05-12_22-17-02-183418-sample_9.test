set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix fuzzy

proc fuzzy_insert { table data } {
  global db
  execsql "INSERT INTO $table VALUES ($data)"
}

do_test fuzzy-1.1 {
  execsql {
    CREATE TABLE people(
      id      PRIMARY KEY,
      name,
      age
    );
    INSERT INTO people VALUES(1, 'John', 30);
  }
  global db
  set db
} {}

do_test fuzzy-1.2 {
  set people_id
  execsql {SELECT id FROM people WHERE age=30 }
  set people_id
} {1}

do_test fuzzy-1.3 {
  fuzzy_insert people 2 John 25
  execsql {SELECT id FROM people}
} {1 2}

do_execsql_test fuzzy-1.4 {
  BEGIN;
  INSERT INTO people VALUES(3, 'Sarah', 30);
  COMMIT;
  SELECT name FROM people
} {John Sarah}

set index1
execsql {
  CREATE INDEX idx_people_name ON people(name);
}
execsql {
  CREATE INDEX idx_people_age ON people(age);
}

do_execsql_test fuzzy-1.5 {
  SELECT name FROM people WHERE age = 30
} {John Sarah}

set index2
execsql {
  CREATE UNIQUE INDEX idx_people_id ON people id
}

do_execsql_test fuzzy-1.6 {
  SELECT name FROM people WHERE id = 1
} {John}

set trigger1
execsql {
  CREATE TRIGGER tr_before_each before each  on people
  FOR EACH ROW
  BEGIN
     SELECT 10
  END
}

do_test fuzzy-1.7 {
  list 10
  execsql {SELECT 10}
} {10 10}

do_execsql_test fuzzy-1.8 {
  SELECT name FROM people WHERE id = 2
} {John}

finish_test