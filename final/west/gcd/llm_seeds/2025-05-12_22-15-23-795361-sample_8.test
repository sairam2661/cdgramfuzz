set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix fuzz

proc fuzz_func {} {
  set seed 1234567890
  set size 100
  set str ""
  for {set i 0} {$i lt $size} {incr i} {
    append str "abcdefghijklmnopqrstuvwxyz1234567890" $i
  }
  set seed 0
  incr seed
  expr {int64 rand128 $seed}
}

proc fuzz_func_2 {n} {
  set res ""
  for {set i 0} {$i lt $n} {incr i} {
    append res "[$fuzz_func] " $i
  }
  return $res
}

proc test_func {n} {
  set sql ""
  for {set i 0} {$i lt $n} {incr i} {
    append sql "SELECT 1"
  }
  return $sql
}

proc fuzz_func_execsql {n} {
  do_execsql_test fuzz_func_execsql $n {
    $test_func $n
  }
}

do_test fuzz-1.1 {
  set val 10
  set res 0
  for {set i 0} {$i lt $val} {incr i} {
    incr res
  }
  return $res
} {10}

ifcapable trigger {
  do_test fuzz-1.2 {
    db eval {CREATE TABLE t1(a)}
    db eval {
      CREATE TRIGGER t1_trigger BEFORE UPDATE ON t1 FOR EACH ROW
      WHEN newa IS NOT NULL THEN
        BEGIN
          INSERT INTO t1 VALUESicana
        END
    }
    db eval {UPDATE t1 SET a IS NULL}
  } {}
}

set n 10
for {set i 0} {$i lt 10} {incr i} {
  fuzz_func_execsql $n
}

finish_test