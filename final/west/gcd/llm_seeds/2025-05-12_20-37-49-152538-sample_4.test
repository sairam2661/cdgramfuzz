set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix sqlite_fuzz

proc fuzzer {} {
  set sql "SELECT * FROM (SELECT 1"
  for {set i 0} {$i lt 100} {incr i} {
    append sql ",?"
  }
  append sql ") WHERE rowid =?"
  set param {}
  for {set i 0} {$i lt 100} {incr i} {
    lappend param 1
  }
  lappend param 1
  return "$sql $param"
}

proc fuzztest {sql} {
  sqlite3 db test
  db func random random
  set id {SELECT random(   *) FROM main}
  db eval "$sql"
  execsql {SELECT id FROM main} db
  db close
  if {  } {
    puts $sql
    puts $param
  } else {
    incr count
  }
  finish_fuzztest
}

do_fuzztest sqlite_fuzz {

  eval fuzzer
  fuzztest $sql

  execsql {
    CREATE TABLE x(y);
  }
  do_execsql_test 2 {
    SELECT * FROM x;
  } {}
  do_execsql_test 3 {
    INSERT INTO x VALUES(1);
    SELECT * FROM x;
  } {1}
  do_test 4 {
    execsql {
      SELECT * FROM x;
    }
  } {1}

}

finish_test