set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix query

proc query_proc {} {
  global queryargs
  lappend queryargs
  expr {1}
}

proc do_execsql_test {name sql expected} {
  uplevel do_execsql_test $name "[execsql $sql]" $expected
}

do_test query-1.1 {
  execsql {
    CREATE TABLE b(y);
    INSERT INTO b VALUES(1.0,2.0,"three",4);
  }
  execsql {SELECT * FROM b}
} {1.0 2.0 three 4}

proc get_count {sql} {
  set dbhandle test_db
  db eval $sql
  return $db EvalCount
}

set data {
  1.0 2.0 "three" 4
  5.0 6.0 "seven" 8
  9.0 10.0 "ten" 11
}

foreach row $data {
  execsql {INSERT INTO b VALUES(1.0,2.0,"three",4)}
}

do_execsql_test query-1.2 {
  SELECT * FROM b WHERE y = 2.0;
} {2.0 2.0 "three" 4}

do_test query-1.3 {
  set count 0
  db eval {SELECT * FROM b}
  incr count
  incr count
  incr count
  return $count
} 3

proc query_exec_test {sql} {
  global queryargs
  set result_count 0
  catch {execsql $sql} result
  lappend queryargs $result
  return $queryargs
}

ifcapable temp_db {
  do_execsql_test query-1.4 {
    PRAGMA temp_database = 1;
    SELECT * FROM b;
  } {}
}

finish_test