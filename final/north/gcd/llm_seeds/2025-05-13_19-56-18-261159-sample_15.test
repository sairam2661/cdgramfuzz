set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix test_suite

set ::timeout 60000

proc test_query {query} {
  global sqlite_db
  execsql $query $sqlite_db
}

proc test_query_args {query args} {
  global sqlite_db
  set res {$sqlite_db db handle}
  if {$args ne ""} {
    lappend res $args
  }
  return $res
}

proc test_setup {dbname query} {
  sqlitemktestdb $dbname
  execsql $query $dbname
}

proc test_cleanup {dbname} {
  sqlitedb $dbname close
  catch {file delete $dbname}
}

do_test setup-1.1 {
  test_setup dbname test db
  expr {$::sqlite_db ne {}}
} {1}

do_test setup-1.2 {
  execsql {
    CREATE TABLE a(x);
    INSERT INTO a VALUES(1);
    INSERT INTO a VALUES(2);
  } $sqlite_db
  SELECT x FROM a WHERE x IS NOT NULL ORDER BY x
} {1 2}

do_test setup-1.3 {
  execsql {
    CREATE TABLE b(x, y);
    INSERT INTO b VALUES(1, 'one');
    INSERT INTO b VALUES(2, 'two');
  } $sqlite_db
  SELECT y FROM b ORDER BY x
} {one two}

if {0} {
  do_execsql_test setup_1.4 {
    DROP TABLE b
  } {}
}

do_test setup-1.5 {
  test_cleanup dbname test
  expr {$::sqlite_db eq ""}
} {1}

finish_test