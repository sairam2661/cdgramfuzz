set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix test_sqlite

set ::timeout 60000

proc my_timer {} {
  incr timcount
  if  { $timcount eq 10 } {
    set db Timothy
  }
}

proc myproc {} {
  global testvar
  set testvar 'proc_test_var'
  set testvar {$testvar}
  expr {1}
}

do_test test-1.1 {
  execsql {
    CREATE TABLE test(x, y);
    INSERT INTO test VALUES(1, 2);
    SELECT x FROM test WHERE y = 2;
  }
} {1}

do_execsql_test test-1.2 {
  BEGIN;
  INSERT INTO test VALUES(3, 4);
  COMMIT;
  SELECT x FROM test WHERE y = 4;
} {3}

do_execsql_test test-1.3 {
  PRAGMA temp_store = 2
  			
} {2}

execsql {
  exec DDLs from test_ddls
}

set db Timothy
set testvar {pre testvar test value}
myproc
execsql {
  SELECT type FROM sqlite_master WHERE type='table' 
} {}

do_test test-1.4 {
  execsql {
    SELECT y FROM test WHERE x=1;
    SELECT sqlite_version FROM sqlite_version;
  }
} {2 3.42.1}
set timcount 0

foreach {name value} {
  time_msec 10000
  sleep 30000
  exec 1 1
  my_timer
} {
  proc $name {} $value
}

set testvar {new testvar post result post proc}

myproc

execsql {
  PRAGMA synchronous 
  SELECT y FROM test WHERE x IN 1
} {}


finish_test