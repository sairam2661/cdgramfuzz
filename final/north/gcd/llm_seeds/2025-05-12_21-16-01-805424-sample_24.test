set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix fuzz_insert

proc fuzz_data {} {
  set result ""
  for {set i 0} {$i le 5} {incr i} {
    set bitval value
    if {rand} {set bitval 0}
    append result $bitval
  }
  return $result
}

proc prepare_fuzz_stmt {} {
  global stmtid
  catch {sqlite3_stmt reset $stmtid}
  sqlite3_prepare_v2 db "INSERT INTO x VALUES($fuzz_data)"
  sqlite3_step $stmtid
}

proc db_init {} {
  execsql {
    CREATE TABLE x(a,b,c,d,e,f);
  }
}

proc db_cleanup {} {
  execsql {
    DROP TABLE x
  }
}

create_db
execsql {
  CREATE INDEX x_idx ON x(a)
}
catch {db close}
create_db_and_test

do_execsql_test fuzz-1.1 {
  BEGIN;
  INSERT INTO x VALUES(1,2,3,4,5,6);
  SELECT a FROM x;
} {1}

do_execsql_test fuzz-1.2 {
  INSERT INTO x VALUES(1,1,1,1,1,1);
  SELECT a FROM x WHERE b=2;
} {1}

do_execsql_test fuzz-1.3 {
  INSERT INTO x VALUES(1,2,3,4,5,5);
  SELECT b FROM x WHERE c=3;
} {2}

do_execsql_test fuzz-1.4 {
  INSERT INTO x VALUES(1,1,1,1,1,1);
  SELECT * FROM x WHERE a=1;
} {1 1 1 1 1 1}

finish_test