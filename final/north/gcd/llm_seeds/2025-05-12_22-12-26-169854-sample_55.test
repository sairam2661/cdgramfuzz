set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix sync

proc sync_proc {} {
  global syncargs
  lappend syncargs
  expr {llength $syncargs}
}

do_test sync-1.1 {
  sqlite3 db test
  db transaction {
    CREATE TABLE b(id, data);
    INSERT INTO b VALUES(1, 'row1');
    INSERT INTO b VALUES(2, 'row2');
  }
  db query {SELECT COUNT(*) FROM b}
} {2}

do_execsql_test sync-1.2 {
  BEGIN;
  INSERT INTO b VALUES(3, 'row3');
  COMMIT;
  SELECT COUNT(*) FROM b;
} {3}

ifcapable wal_journal {
  do_execsql_test sync-1.3 {
    PRAGMA journal_mode = "wal"
  }
  {wal {1 {journal_mode set to wal}}}
}

do_test sync-1.4 {
  catch {execsql {SELECT b FROM c;}}
} {1}

do_catchsql_test sync_1.5 {
  execsql {SELECT sqlite_version}
   {1 {disk I full}}
} 

db close
finish_test