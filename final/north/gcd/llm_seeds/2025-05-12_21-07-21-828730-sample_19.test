set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix mytest

proc my_func {} {
  global my_var
  set my_var "foo"
  expr {2}
}

set my_var ""

do_test mytest-1.1 {
  execsql {
    CREATE TABLE b(y);
    INSERT INTO b VALUES(5);
  }
  execsql {SELECT COUNT(*) FROM b}
} {1}

do_execsql_test mytest-1.2 {
  BEGIN;
  INSERT INTO b VALUES(6);
  COMMIT;
  SELECT COUNT(*) FROM b
} {2}

do_test mytest-1.3 {
  set my_func
  expr {3}
} {3}

do_execsql_test mytest-1.4 {
  BEGIN;
  INSERT INTO b VALUES(7);
  COMMIT;
  SELECT * FROM b;
  SELECT * FROM b;
} {5}

do_execsql_test mytest-1.5 {
  SELECT 2 FROM b
} {2}

set my_var "bar"

finish_test