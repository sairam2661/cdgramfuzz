set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix test

proc sqlite_query {} {
  global testargs
  lappend testargs "SELECT * FROM test"
  expr 1
}

proc query_limit {} {
  ifcapable {query_planner_stats} {
    execsql {
      PRAGMA query_planner_stats;
    }
  } else {
     expr true
  }
}

do_test test-1.1 {
  execsql {
    CREATE TABLE test(a, b);
    INSERT INTO test VALUES(1, 2);
  }
  execsql {
    SELECT a FROM test;
  }
} {1}

do_test test-1.2 {
  execsql {
    SELECT * FROM test;
    PRAGMA data_version;
  }
} {1 2 1}

do_test test-1.3 {
  set db3 {}
  set db3name "test-1.3.db"
  execsql {
    ATTACH '$db3name' AS db3
  } $db3
  execsql {
    SELECT * FROM db3test;
  } $db3
} {}

ifcapable {wal} {
  do_test test1.4 {
    db function sqlite_sync sync_proc
    execsql {
      CREATE TABLE c(a, b);
    }
    sqlite_query
    query_limit
  } {1 1}
}

db2 eval {
  PRAGMA case_sensitive_like
}
query_limit

finish_test

proc delete_table {} {
  global delete_table_name
  execsql {
    DROP TABLE $delete_table_name
  }
}

set testcase {test1.5}
do_test $testcase {
  delete_table
  execsql {
    CREATE TABLE t1 AS SELECT x FROM t1
  }
} {}

set testcase {test1.5}
do_test $testcase {
  delete_table
  sqlite3 db1 test1_5
  db1 eval {
    CREATE TABLE t1(x, y);
    SELECT * FROM t1;
  }
} {}

db2 eval {
  execsql {
    SELECT x FROM x
  }
}

db2 close

if 0 {finish_test}

db3 close
finish_test