set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix test2

proc test2_func {} {
  global testargs
  lappend testargs a
  lappend testargs b
  expr {1}
}

proc test2_func_2 {} {
  global testargs
  set testargs {}
}

test2_func_2

execsql {
  CREATE TABLE b(y);
  INSERT INTO b VALUES('a');
  INSERT INTO b VALUES('b');
}

do_test test2-1.1 {
  execsql {
    SELECT * FROM b;
  }
} {a {b}}

do_execsql_test test2-1.2 {
  BEGIN;
  INSERT INTO b VALUES('c');
  COMMIT;
  SELECT * FROM b;
} {a b c}

ifcapable wal {
  ifcapable wal_mode {
    test2_func
    do_execsql_test test2-1.3 {
      PRAGMA journal_mode;
    } {wal}
  } else {
    test2_func_2
    do_execsql_test test2 1.4 {
      PRAGMA journal_mode
    } {DELETE}
  }
} else {
  test2_func_2
  set testargs {}
  do_execsql_test test2 1.5 {
    PRAGMA locking_mode
  } {NORMAL}
}

set testargs {}
finish_test