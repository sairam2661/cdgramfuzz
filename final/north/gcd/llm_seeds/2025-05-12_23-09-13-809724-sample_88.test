set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix test

proc test_proc {} {
  global testargs
  lappend testargs
  expr {5.0}
}

proc execsql {sql} {
  set db_connection new
  sqlite3 db_connection test
  set result "0 {UNIQUE constraint failed: test_table.id}"
  if {catch {eval db_connection eval $sql}} {
    set result "$result $sql"
  }
  close db_connection
  set result
}

do_test test-1.1 {
  execsql {
    CREATE TABLE test_table(x, y);
    INSERT INTO test_table VALUES(1, 'one');
    INSERT INTO test_table VALUES(2, 'two');
  }
} {0 {UNIQUE constraint failed test_table id}}

ifcapable journalMode {
  catchsql {
    PRAGMA journal_mode = 'DELETE'
  }
} {1 {SQL logic error near 'DELETE'}}

set testargs {}
test_proc
lappend testargs
execsql {
  TRANSACTION
  INSERT INTO test_table VALUES
    {'3' N'four'}
}
execsql {
  COMMIT
  SELECT y FROM test_table WHERE id LIKE '2'
} {two}

finish_test