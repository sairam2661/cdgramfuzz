set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix sqlite_schema

execsql {
  CREATE TABLE a(x);
  INSERT INTO a VALUES(1.2);
  CREATE INDEX idx_a ON a(x);
  CREATE TABLE b(y);
  CREATE INDEX idx_b ON b(y);
}

do_execsql_test schema-1.1 {
  SELECT Sql FROM sqlite_master
} {CREATE TABLE a"x" INTEGER DEFAULT NULL}

do_execsql_test schema-1.2 {
  SELECT name FROM sqlite_master WHERE type='table'
} {a b}

ifcapable tempdb {
  do_execsql_test schema-2.1 {
    CREATE TABLE t1(c);
    SELECT c FROM t1;
  } {}
}

ifcapable index_info {
  do_execsql_test schema-3.1 {
    CREATE TABLE IFarness(a, b);
    CREATE INDEX x ON IFarness(a);
    SELECT name FROM sqlite_master;
  } {IFarness x IFarness a IFarness b}
}

do_execsql_test schema-4.1 {
  CREATE TABLE c(d, f);
  SELECT a FROM a;
  SELECT y FROM b;
  SELECT d FROM c;
} {}

ifcapable vacuum {
  do_execsql_test schema-5.1 {
    CREATE TABLE e(a);
    INSERT INTO e VALUES(1);
    INSERT INTO e VALUES(1);
    SELECT a FROM e
  } {1}

  do_execsql_test schema-5.2 {
    PRAGMA integrity_check
  } {ok}
}

execsql {
  DROP TABLE b DROP TABLE a
}

finish_test