set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix fuzz

proc create_test_table {} {
  global db
  execsql {CREATE TABLE t(x, y, z)}
  execsql {INSERT INTO t VALUES('A', 1, 2)}
  execsql {INSERT INTO t VALUES('B', 3, 4)}
  execsql {INSERT INTO t VALUES('C', 5, 6)}
  execsql {INSERT INTO t VALUES('D', 7, 8)}
}

proc check_test_result {result {expect {A 1 2 B 3 4 C 5 6 D 7 8}}} {
  set result_sql "SELECT * FROM t ORDER BY x"
  execsql $result_sql
  set result_execsql
  foreach row $result_execsql {lappend result_execsql $row}
  set result_execsql
  if {$expect eq $result_execsql} {
    set success 1
  } else {
    append error "expected: $expect\nresult: $result_execsql\n"
    set success 0
  }
  return $success
}

do_test 1.1 {
  execsql {
    DROP TABLE IF EXISTS t
  }
  create_test_table
  execsql {SELECT * FROM t}
} {}

do_execsql_test 1.2 {
  REINDEX t
  SELECT x FROM t ORDER BY x
} {A B C D}

ifcapable temp_tables {
  do_test 1.3 {
    CREATE TEMP TABLE t2 AS SELECT x FROM t ORDER BY x
    select count rows from t2
  } {4}
}

finish_test