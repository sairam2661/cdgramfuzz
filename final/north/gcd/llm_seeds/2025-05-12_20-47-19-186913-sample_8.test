set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix fuzzy

proc fuzzy_proc {arg1 arg2} {
  global arg3 arg4 result
  incr arg3
  set arg4 {}
  append arg4 $arg1
  lappend result $arg2
  set result
}

set arg1 1
set result {}

do_test fuzzy-1.1 {
  fuzzy_proc "val1" "result1"
  fuzzy_proc "val2" "result2"
  set result
} {val1 result1 val2 result2}

do_test fuzzy-2.1 {
  set arg3 5
  set result {}
  fuzzy_proc "val3" "result3"
  fuzzy_proc "val4" "result4"
  set result
} {val3 result3 val4 result4 6 {}}

set arg1 10

set db2 {}
ifcapable wal_mode {
  db2 close
  execsql {PRAGMA journal_mode = 'WAL'}
  db2 open
} else {
  execsql {PRAGMA journal_mode = 'PERSIST'}
}
register_db db2
db2 eval {
  CREATE TABLE b(x, y);
  INSERT INTO b VALUES(5, 6);
}

do_execsql_test fuzzy-3.1 {
  SELECT x FROM b
} {5}

finish_test