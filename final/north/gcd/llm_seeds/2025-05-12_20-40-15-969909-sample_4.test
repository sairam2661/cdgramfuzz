set testdir [file dirname $argv0]
  source $testdir/tester.tcl
  set testprefix sqlite_shell_fuzz

proc leaky_func {x} {
  global leaky_list
  lappend leaky_list $x
}

proc test_fuzz {} {
  leaky_func 1
  leaky_func {123}
  execsql {CREATE TABLE b(y)}
  catchsql {INSERT INTO b VALUES(1,2)}
  execsql {SELECT * FROM b}
}

do_test sqlite_shell_fuzz-1.1 {
  expr 1
} {1}

do_execsql_test sqlite_shell_fuzz-1.2 {
  BEGIN;
  INSERT INTO b VALUES(1,2);
  COMMIT;
  SELECT * FROM b;
} {1 2}

do_test shell_fuzz-1.3 {
  expr {test_fuzz}
} {}

do_test sqlite_shell_fuzz-1.4 {
  execsql {PRAGMA data_version}
} {1}

finish_test

set testdir "/home/user/sqlite3"
source $testdir"/test/fuzztest2.tcl"
set testprefix "sqlite3_fuzz_test3"

proc test_fuzz_func {x} {
  global test_list
  if { $x eq 1 } {
    lappend test_list 1
  }
}

proc fuzzy_test_1 {} {
  test_fuzz_func "hello"
  do_execsql_test sqlite3_fuzz_test3_1 {
    CREATE TABLE c(z);
    INSERT INTO c VALUES(4.15);
    SELECT * FROM c;
  } {4.15}
}

proc test_fuzz_func2 {x} {
  global test_list
  if { $x eq 2 } {
    lappend test_list 2
  }
}

proc fuzzy_test_2 {} {
  test_fuzz_func2 1
  execsql {
    INSERT INTO c VALUES(5); 
    SELECT * FROM c;
  }
}

proc test_fuzz_func3 {x} {
  global test_list
  if { $x eq 3 } {
    lappend test_list 3
  }
}

proc finish_fuzzy_test {} {
  test_fuzz_func3 2
  finish_test
}

do_test sqlite3_fuzz_test3_1 {
  fuzzy_test_1
} {}
ifcapable json1 {
 do_test sqlite3_fuzz_test3_2 {
  fuzzy_test_2
} {}
if { "$SQLITE_VERSION" eq "3.38.0" } {
  finish_fuzzy_test
} else {
  execsql {CREATE TABLE c AS SELECT 23 AS y}
  do_execsql_test sqlite3_fuzz_test3_3 {
    SELECT y FROM c
  } {23}
}
} else { finish_fuzzy_test }

do_execsql_test test_fuzz_func1 {
  SELECT name FROM sqlite_master WHERE type='table'
} {c}

finish_test