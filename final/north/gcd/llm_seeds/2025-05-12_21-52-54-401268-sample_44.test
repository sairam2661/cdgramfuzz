set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix test_fuzz

proc test_fuzz_proc {db} {
  set stmt $db prepare {
    CREATE TABLE a(x);
    INSERT INTO a VALUES(1);
  }
  $stmt step
  set result $stmt finalize
  set stmt $db prepare {
    SELECT x FROM a;
  }
  $stmt step
  set result $result
  set stmt $db prepare {
    CREATE TABLE b(x);
    INSERT INTO b VALUES(2);
  }
  $stmt step
  set result $result
  $stmt finalize
  set result
}

set test_fuzz_data "

CREATE TABLE c(x);

INSERT INTO c VALUES();

INSERT INTO c VALUES(1);

INSERT INTO c VALUES(1, 2);

INSERT INTO c VALUES(1, 2, 3);

INSERT INTO c VALUES(NULL);

INSERT INTO c VALUES(1.0);

INSERT INTO c VALUES('a');

INSERT INTO c VALUES(NULL, NULL);

INSERT INTO c VALUES(NULL, NULL, NULL);

INSERT INTO c VALUES(1.12345678901234567890);

INSERT INTO c VALUES(X'1234567890');

INSERT INTO c VALUES(X'1234567890abcdef');

"

do_fuzz_test test_fuzz sync_fuzz1 test_fuzz_proc $test_fuzz_data
do_test test_fuzz-7.1 {
  set rc 0
  db close
  error_message {}
} {OK}
do_execsql_test test_fuzz-7.2 {
  SELECT * FROM c
} {}
finish_test