set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix dbmutex

proc dbmutex_proc {} {
  proc get_mutex {} {
    return "mutex"
  }
}

do_execsql_test dbmutex-1.1 {
  CREATE TABLE a(x);
  INSERT INTO a VALUES(1);
  SELECT get_mutex
  FROM sqlite_master
  WHERE type='table' 
} {mutex}

do_test dbmutex-1.2 {
  db mutex list
} {mutex}

ifcapable journalMode {
  catchsql {
    PRAGMA journal_mode = 'persist'
  }
} {0 {}}

ifcapable tempdb {
  do_execsql_test dbmutex-2.1 {
    CREATE TABLE t(a);
    INSERT INTO t VALUES (5);
  } {}
  do_test dbmutex-2.2 {
    db mutex list
  } {mutex}
}

finish_test