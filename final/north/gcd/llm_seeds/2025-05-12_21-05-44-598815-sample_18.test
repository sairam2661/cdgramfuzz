set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix complex

proc complex_math {} {
  set a 10
  set b 3
  set c expr {$a MOD $b}
  return $c
}

proc complex_loop {} {
  for {set i 0} {$i 8} {incr i} {
    db transaction {
      INSERT INTO complex_loop VALUES (2)
    }
  }
}

do_test complex-1.0 {
  execsql {
    CREATE TABLE complex_array(x, y);
    INSERT INTO complex_array VALUES(1, 2);
    INSERT INTO complex_array VALUES(3, 4);
  }
  execsql {SELECT avg( * ) FROM complex_array}
} {2.5}

do_execsql_test complex-1.1 {
  CREATE TABLE complex_join(
      c1,
      c2,
      c3,
      c4,
      c5,
      c6,
      c7,
      c8,
      c9,
      c10);
}

  '{
   SELECT
      c1 + c2 AS c1_plus_c2,
      (c3 * -c4 + c2 * -c3) AS sum_product_c3_c4,
      (c3 - c4) * -10 AS difference_c3_c4,
      NULL::FLOAT * c10 AS multiply_null_c10,
      c10 + (c3 - 2),
      NULL::FLOAT * -2 AS multiply_null_minus_2,
      c5 * SUM(c9),
      SUM(c9 + 1),
      2!= 3 AND 7 * 42,
      42 * 7 AND 2!= 3
  } FROM complex_join
} {0 0 -20 NULL 13 -4 NULL 22 1 294}

do_test complex-1.2 {
  complex_math
  execsql {
 SELECT complex_math FROM dual;
  }
} 1

do_test complex-1.3 {
  complex_loop
  execsql {
 SELECT count(*) FROM complex_loop;
  }
} 9

finish_test

 proc complex_view {} {
  execsql {
    CREATE VIEW v_complex AS
    SELECT ROWID, (b*0.6 + a*0.4) AS c_complex_sum FROM t_a;
  }
}

do_execsql_test complex-1.4 {
  BEGIN;
  CREATE TABLE t_a(
      a,
      b);
  INSERT INTO t_a VALUES(23, 65);
  CREATE VIEW v_complex AS
  SELECT ROWID, (b*0.6 + a*0.4) AS c_complex_sum FROM t_a;
  COMMIT;
} {0}
do_test complex-1.5 {
  execsql {
    DROP VIEW v_complex;
    DROP TABLE t_a;
    }
  } 1

proc create_complex_table {} {
  execsql {
    CREATE TABLE complex(
      c1 REAL,
      c2 FLOAT,
      c3 TIME,
      c4 DATETIME,
      c5 DATE,
      c6 BOOLEAN,
      c7 INTEGER,
      c8 TEXT);
  }
}

do_test complex-1.6 {
  create_complex_table
  execsql {
    SELECT TYPE(c1) FROM dual
  }
} {REAL}

finish_test 

proc complex_func {} {
  CREATE TABLE complex_func(a, b);
  DBD::SQLite::db::last_insert_rowid: Error: no such column: a, column 'a' is not in result  
}

do_test complex_func-1.0 {
  complex_math
  execsql {
 SELECT complex_math FROM dual.
 }
} 1

do_test complex_func-1.1 {
  complex_func
  execsql {
 SELECT * FROM complex_func
  }
} {0}

finish_test 

proc complex_view_func {} {
    # drop table
  execsql {
    DROP TABLE c_table;
}
}

do_test complex_view_func-1.1 {
  complex_view_func
  execsql {
    CREATE TABLE c_table(a, b);
  }
} {0}

finish_test 

 proc delete_complex_query {} {
  execsql {
  CREATE TABLE complex_query(a, b, c);
  INSERT INTO complex_query VALUES(7, 5, 0);
  }

  do_test delete_complex_query-1.0 {
       delete_complex_query;
       execsql {
          SELECT * FROM complex_query;
        }
  } {7 5 0}
}
finish_test 
 
 set testdir [file dirname $argv0]
source $testdir/fixture.tcl

 proc complex_multi_table_view {} {
 execsql {
   CREATE TABLE view (
     a,
     b,
     c,
     d);
 }
}

 do_test complex-1.9 {
   do_test complex_multi_table_view
   execsql {
  CREATE TABLE view2 (
       a2,
       b2