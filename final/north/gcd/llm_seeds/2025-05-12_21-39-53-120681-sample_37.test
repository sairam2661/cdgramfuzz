set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix query

proc query_proc {} {
  global queryargs
  lappend queryargs
  expr {1.0}
}

proc query_func {i} {
  expr {$i}
}

ifcapable {read_write} {
  set db "test.db"
  execsql {
    CREATE TABLE a(x);
    CREATE TABLE b(y);
    INSERT INTO a VALUES(1);
    INSERT INTO a VALUES(2);
    INSERT INTO b VALUES(3);
  }

  do_execsql_test query0.1 {
    SELECT * FROM a;
    SELECT * FROM b;
  } {1 {} 2 {} 3 {}}

  do_execsql_test query0.2 {
    SELECT x FROM a UNION SELECT y FROM b
  } {1 3 2}

  do_execsql_test query0.3 {
    SELECT x FROM a UNION ALL SELECT y FROM b
  } {1 2 3}

  do_execsql_test query0.4 {
    SELECT * FROM a;
    SELECT * FROM b;
    SELECT * FROM a
  } {1 {} 2 {}}

  do_execsql_test query0.5 {
    SELECT x FROM a INTERSECT SELECT y FROM b
  } {}

  unset db
}

do_test query0.6 {
  execsql {
    SELECT query_func(   *) FROM a
  }
} {1.0 2.0}

do_test query-1.1 {
  execsql {
    SELECT $query_func  FROM a
  }
} {1.0 2.0}

do_test query-1.2 {
  set res1 ""
  set res2 {}
  catchsql {
    SELECT  $query_proc  FROM a
  } res1 res2
  lappend queryargs
  list $res1  $res2
} {1.000000 {}}
do_execsql_test query-1.3 {
  SELECT * FROM a
} {1 {} 2 {}}

finish_test