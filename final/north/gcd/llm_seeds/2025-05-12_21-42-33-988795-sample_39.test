set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix fuzzer

proc fuzzer_init {} {
  global fuzzer_args
  fuzzer_args 0
}

proc fuzzer_db {} {
  set db {}
  if {$fuzzer_args} { set db db }
  return $db
}

proc fuzzer_execsql {sql} {
  global fuzzer_db
  eval $fuzzer_db eval $sql
}

fuzzer_db

do_test 1.1 {
  fuzzer_execsql {
    CREATE TABLE a(x);
    INSERT INTO a VALUES('abc');
  }
  fuzzer_execsql {SELECT typeof x FROM a}
} abc

do_test 1.2 {
  fuzzer_execsql {
    BEGIN;
    INSERT INTO a VALUES('def');
    COMMIT;
  }
  fuzzer_execsql {SELECT count(*) FROM a}
} 2

do_test 1.3 {
  fuzzer_execsql {
    CREATE TABLE b(y);
    INSERT INTO b VALUES(123);
  }
  fuzzer_execsql {SELECT typeof y FROM b}
} integer

ifcapable subquery {
  do_test 1.4 {
    fuzzer_execsql {
      CREATE TABLE c(z);
      INSERT INTO c VALUES(456);
      SELECT z FROM c
    }
  } 456
}

finish_test