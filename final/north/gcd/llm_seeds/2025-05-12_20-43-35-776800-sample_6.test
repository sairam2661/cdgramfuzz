set testdir [file dirname $argv0]
source $testdir/tester.tcl
set testprefix complex

proc complex_func {} {
  global complex_args
  set complex_args {}
  execsql {
    CREATE TABLE t1(a, b, c, d);
    CREATE TABLE t2(e, f, g, h);
  }
  foreach {a b} {1 2 3 4} { lappend complex_args $a $b }
}

do_execsql_test complex-1.0 {
  SELECT 'test 1.0' FROM dual;
} {test 1.0}

do_test complex-1.1 {
  complex_func
  llength $complex_args
} {4}

do_test complex-1.2 {
  db eval {
    INSERT INTO t1 VALUES(5, 6, 7, 8);
  }
  db eval {
    SELECT * FROM t1
  }
} {5 6 7 8}

do_execsql_test complex-1.3 {
  SELECT 'test 1.3' FROM dual;
} {test 1.3}

do_test complex-1.4 {
  db eval {
    INSERT INTO t2 VALUES(9, 10, 11, 12);
  }
  db eval {
    SELECT * FROM t2
  }
} {9 10 11 12}

ifcapable {trigger} {
  do_execsql_test complex_5.1 {
    CREATE TRIGGER tr_complex AFTER UPDATE ON t1
    FOR EACH ROW BEGIN
      UPDATE t2 SET a3_$rowid$i3 10 WHERE b5 2
    END
  }
}

do_test complex-5.2 {
  db eval {
    UPDATE t1 SET a1 0
  }
  db eval {
    SELECT * FROM t2
  }
} {9 10 11 12}

finish_test